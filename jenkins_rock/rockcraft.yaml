name: Jenkins
summary: Jenkins rock
description: Jenkins OCI image for the Jenkins charm
version: "1.0"
base: bare
build-base: ubuntu:22.04
license: Apache-2.0
env:
  - XDG_DATA_HOME: "/usr/share"
  - FONTCONFIG_PATH: "/etc/fonts"
  - JAVA_HOME: "/usr/lib/jvm/java-11-openjdk"
platforms:
  amd64:

parts:
  jenkins:
    plugin: nil
    stage-packages:
      - bash
      - fonts-dejavu-core
      - libfontconfig1
      - openjdk-11-jre-headless
      - ca-certificates-java
    build-packages:
      - curl
      - unzip
      - libnss3
      - ca-certificates-java
    override-build: |
      curl -sLO https://mirrors.jenkins.io/war/2.387/jenkins.war
      unzip jenkins.war META-INF/MANIFEST.MF
      VERSION=$(grep Jenkins-Version META-INF/MANIFEST.MF | cut -d' ' -f2 | tr -d '\r')
      rm META-INF/MANIFEST.MF

cmd: [/usr/lib/jvm/java-11-openjdk/bin/java -Djava.awt.headless=true -jar jenkins.war]
